@using model = StokTakipProjesi2.Controllers.StoreController;
@{
    Layout = "_AdminLayout";
    var groupedStocks = model.StockList.GroupBy(s => s.Owner);
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<div class="accordion" id="ownerAccordion">
    @foreach (var group in groupedStocks)
    {
        var ownerId = group.Key;
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading-@ownerId">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-@ownerId" aria-expanded="false" aria-controls="collapse-@ownerId">
                    <i class="bi bi-person-fill me-2"></i> @group.Key
                </button>
            </h2>
            <div id="collapse-@ownerId" class="accordion-collapse collapse" aria-labelledby="heading-@ownerId" data-bs-parent="#ownerAccordion">
                <div class="accordion-body">
                    <table class="table table-bordered table-hover align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th>Stock Name</th>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Unit Price</th>
                                <th>Total Price</th>
                                <th>Status</th>
                                <th>Process</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in group)
                            {
                                <tr>
                                    <td>
                                        <strong>@item.Name</strong><br />
                                        <small class="text-muted">@item.Description</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-info text-dark">@item.Category</span>
                                    </td>
                                    <td class="@(item.StockCount <= 2 ? "text-danger" : "")">@item.StockCount</td>
                                    <td>@item.Price.ToString("N2") ₺</td>
                                    <td>@(item.Price * item.StockCount) ₺</td>
                                    <td>
                                        @if (item.StockCount <= 2)
                                        {
                                            <span class="badge bg-danger"><i class="bi bi-exclamation-triangle"></i> Critical</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success"><i class="bi bi-check-circle"></i> In Stock</span>
                                        }
                                    </td>
                                    <td>
                                        <a class="btn btn-info btn-sm" title="Details" asp-action="Read" asp-controller="Admin" asp-route-id="@item.StockID"><i class="bi bi-eye"></i></a>
                                        <a class="btn btn-warning btn-sm" title="Edit" asp-action="Update" asp-controller="Admin" asp-route-id="@item.StockID"><i class="bi bi-pencil-square"></i></a>
                                        <a class="btn btn-danger btn-sm" title="Delete" asp-action="Delete" asp-controller="Admin" asp-route-id="@item.StockID"><i class="bi bi-trash"></i></a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
</div>
